<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: fluentd | sgykfjsm.github.com]]></title>
  <link href="http://sgykfjsm.github.io/blog/categories/fluentd/atom.xml" rel="self"/>
  <link href="http://sgykfjsm.github.io/"/>
  <updated>2017-09-26T01:32:46+09:00</updated>
  <id>http://sgykfjsm.github.io/</id>
  <author>
    <name><![CDATA[sgykfjsm]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ec2ã«couchbaseã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚ã¤ã„ã§ã«Python SDKã¨td-agentã‚‚ã€‚]]></title>
    <link href="http://sgykfjsm.github.io/blog/2013/08/18/couchbase-on-ec2-with-td-agent/"/>
    <updated>2013-08-18T22:46:00+09:00</updated>
    <id>http://sgykfjsm.github.io/blog/2013/08/18/couchbase-on-ec2-with-td-agent</id>
    <content type="html"><![CDATA[<a name="L......"></a>
<h2>ç›®çš„</h2>

<p>ec2ã«Couchbaseã‚’å…¥ã‚Œã‚‹ã¤ã„ã§ã«ã€fluentdã§é›†ã‚ãŸãƒ­ã‚°ã‚’couchbaseã«è²¯ã‚ã“ã‚€ã€‚</p>

<a name="couchbase............"></a>
<h2>couchbaseã«ã¤ã„ã¦</h2>

<ul>
<li>å…ƒã€…ã¯Lutus Notesã‚’èµ·æºã«æŒã¤<a href="http://couchdb.apache.org/">CouchDB</a>ã®é–‹ç™ºè€…ã®ã²ã¨ã‚Šã§ã‚ã‚‹Damien Katzæ°ãŒå•†æ¥­å±•é–‹ã—ã¦ã„ã‚‹è£½å“ã€‚</li>
<li>Memcachedã‚‚ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€<a href="http://www.couchbase.com/jp/memcached">Memcachedã‚’Couchbaseã‚¯ãƒ©ã‚¹ã‚¿ã«ãƒªãƒ—ãƒ¬ãƒ¼ã‚¹ã—ãŸäº‹ä¾‹ã‚‚ã‚ã‚‹ã€‚</a></li>
<li>Enterprise Edition(EE)ã¨Community Edition(CE)ã®ï¼’ã¤ãŒã‚ã‚Šã€å‰è€…ã¯2nodeã¾ã§ç„¡æ–™ã€å¾Œè€…ã¯ç„¡åˆ¶é™ã«ç„¡æ–™ã§ä½¿ãˆã‚‹ã€‚</li>
<li>EEã¨CEã®é•ã„ã¯ã€EEã§ã¯ã‚µãƒãƒ¼ãƒˆãŒè³¼å…¥ã§ãã€CEã«æ¯”ã¹å…ˆé€²çš„ãªæ©Ÿèƒ½ãŒä»˜å±ã—ã¦ã„ã‚‹ã€‚å¯¾ã—ã¦CEã¯EEã®å‹è½ã¡ã®ã‚ˆã†ãªä½ç½®ã¥ã‘ã§ã‚ã‚‹ã€‚</li>
<li>MongoDBã¨åŒã˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‹NoSQLã«ä½ç½®ã¥ã‘ã‚‰ã‚Œã‚‹ã€‚</li>
<li>è‡ªå‹•ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€åˆ†æ•£ã‚¯ã‚¨ãƒªã€ç‹¬ç«‹ã—ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥éƒ¡ãªã©ã®æ©Ÿèƒ½ã‚„ç‰¹å¾´ã‚’æŒã¤ã€‚</li>
</ul>


<!-- more -->


<a name="L......"></a>
<h2>å°å…¥</h2>

<p>ä»Šå›ã¯EC2ã®m1.smallã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŒã€AWSã®<a href="http://aws.typepad.com/aws_japan/2013/08/running-couchbase-on-aws-new-white-paper.html">ãƒ›ãƒ¯ã‚¤ãƒˆãƒšãƒ¼ãƒ‘ãƒ¼</a>ã§ã¯æœ€å°ã§ã‚‚largeã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹ã€‚ä»Šå›ã¯ãŠéŠã³ãªã®ã§ã€smallã¨ã™ã‚‹ãŒæœ¬ç•ªåˆ©ç”¨æ™‚ã«ã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¹ã‚±ãƒ¼ãƒ«ã¯é«˜ã‚ã«ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚</p>

<p>AWSã®market placeã«ã¯<a href="https://aws.amazon.com/marketplace/search/results/ref=gtw_navgno_search_box?searchTerms=couchbase&amp;search=">AMIãŒç”¨æ„</a>ã•ã‚Œã¦ãŠã‚Šã€ä¸€æ–¹ã§ã¯RightScaleã«ã‚ˆã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‚ã‚ã‚‹ã€‚(<a href="http://www.couchbase.com/docs/couchbase-manual-2.1.0/couchbase-bestpractice-cloud.html">4.6. Using Couchbase in the Cloud</a>)</p>

<p>ã“ã®ã‚ˆã†ã«æ‰‹è»½ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã®æ–¹æ³•ãŒã‚ã‚‹ãŒã€ä»Šå›ã¯å­¦ç¿’ã®ãŸã‚RPMã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã†ã€‚</p>

<p>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã¯ä»¥ä¸‹ã®URLã§ã‚ã‚‹ã€‚<br>
<a href="http://www.couchbase.com/jp/download">http://www.couchbase.com/jp/download</a></p>

<p>ã“ã‚Œä»¥é™ã®ä½œæ¥­ã¯ç”¨æ„ã—ãŸEC2ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦è¡Œã†ã€‚</p>

<a name="L............"></a>
<h3>äº‹å‰æº–å‚™</h3>

<p>ã“ã‚Œã¯ã¨ã¦ã‚‚é‡è¦ãªã®ã ã‘ã©ã€ç«‹ã¡ä¸Šã’ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯ElasticIPã‚’æŒ¯ã£ã¦ãŠãã“ã¨ã€‚ã§ãªã„ã¨ã€SDKã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå‡ºæ¥ãªã„ã€‚
ãªãœãã†ãªã®ã‹ã¯ã¾ã ç†ç”±ãŒã¤ã‹ã‚ã¦ã„ãªã„ã€‚
ã¾ãŸã€ã‚‚ã—Couchbase Serverã®nodeåãŒPrivate IPsã«ãªã£ã¦ã„ãŸã‚‰ã€ä»¥ä¸‹ã®æ‰‹é †ã«ã—ãŸãŒã£ã¦nodeåã‚’å¤‰æ›´ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚</p>

<ul>
<li><a href="http://www.couchbase.com/docs/couchbase-manual-2.0/couchbase-getting-started-hostnames-pre2.0.html">2.4.1. Hostnames for Couchbase Server 2.0.1 and Earlier</a></li>
</ul>


<p>ã“ã®è¨­å®šã‚’ã—ã¦ãªã„ã¨ã¨ã¦ã‚‚å¤§å¤‰ãªã“ã¨ã«ãªã‚‹ã€‚</p>

<a name="OpenSSL............"></a>
<h3>OpenSSLã‚’å…¥ã‚Œã‚‹</h3>

<pre><code>[ec2-user@ip-xx-xxx-xx-xxx tmp]$ sudo yum install -y openssl098e
Loaded plugins: priorities, security, update-motd, upgrade-helper
amzn-main                                                                                                        | 2.1 kB     00:00
# çœç•¥
Installed:
  openssl098e.x86_64 0:0.9.8e-17.8.amzn1

Complete!
</code></pre>

<a name="couchbase.server.2.0.1............"></a>
<h3>couchbase server 2.0.1ã‚’å…¥ã‚Œã‚‹</h3>

<p>å–å¾—å…ƒã®URLã¯<a href="http://www.couchbase.com/jp/download">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸</a>ã‹ã‚‰ã€‚</p>

<pre><code>[ec2-user@ip-xx-xxx-xx-xxx tmp]$ wget http://packages.couchbase.com/releases/2.0.1/couchbase-server-community_x86_64_2.0.1.rpm
--2013-08-11 08:47:37--  http://packages.couchbase.com/releases/2.0.1/couchbase-server-community_x86_64_2.0.1.rpm
# çœç•¥
2013-08-11 08:49:00 (1.47 MB/s) - `couchbase-server-community_x86_64_2.0.1.rpm' ã¸ä¿å­˜å®Œäº† [126631806/126631806]
[ec2-user@ip-xx-xxx-xx-xxx tmp]$ sudo rpm -ivh couchbase-server-community_x86_64_2.0.1.rpm
æº–å‚™ä¸­...                ########################################### [100%]
Minimum RAM required  : 4 GB
System RAM configured : 1696704 kB

Minimum number of processors required : 4 cores
Number of processors on the system    : 1 cores

   1:couchbase-server       ########################################### [100%]
Starting couchbase-server[  OK  ]

You have successfully installed Couchbase Server.
Please browse to http://ip-xx-xxx-xx-xxx:8091/ to configure your server.
Please refer to http://couchbase.com for additional resources.

Please note that you have to update your firewall configuration to
allow connections to the following ports: 11211, 11210, 11209, 4369,
8091, 8092 and from 21100 to 21299.

By using this software you agree to the End User License Agreement.
See /opt/couchbase/LICENSE.txt.
</code></pre>

<p>ãƒ­ã‚°ã«ä»¥ä¸‹ã®ã‚ˆã†ã«å‡ºã¦ã„ã‚‹ã‘ã©ã€å…¨ãè¶³ã‚Šã¦ãªã„â€¦ã€ãŒã€ä»Šå›ã¯å­¦ç¿’ã®ãŸã‚ãªã®ã§æ°—ã«ã—ãªã„ã€‚ãªãŠã€ã‚³ãƒ¬ã‚’æº€ãŸã™ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯largeã¾ãŸã¯xlargeã‹ã‚‰ãªã®ã§ã€NoSQLç³»ã¯ã‚„ã¯ã‚Šãªã‚“ã ã‹ã‚“ã è¨€ã£ã¦ãŠé‡‘ãŒç„¡ã„ã¨ãƒ€ãƒ¡ãªã®ã§ã‚ã‚‹ã€‚
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Minimum RAM required  : 4 GB
</span><span class='line'>System RAM configured : 1696704 kB&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Minimum number of processors required : 4 cores
</span><span class='line'>Number of processors on the system    : 1 cores</span></code></pre></td></tr></table></div></figure></p>

<p>ã‚ã¨ã¯æŒ‡å®šã•ã‚ŒãŸURL:<a href="http://ip-xx-xxx-xx-xxx:8091/%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6GUI%E3%81%AE%E3%82%A6%E3%82%A3%E3%82%B6%E3%83%BC%E3%83%89%E3%81%AB%E5%BE%93%E3%81%A3%E3%81%A6%E3%81%84%E3%81%91%E3%81%B0%E5%B0%8E%E5%85%A5%E3%81%AF%E7%B5%82%E4%BA%86%E3%80%82%E7%B0%A1%E5%8D%98%E3%81%A7%E3%81%82%E3%82%8B%E3%80%82">http://ip-xx-xxx-xx-xxx:8091/%E3%81%AB%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%97%E3%81%A6GUI%E3%81%AE%E3%82%A6%E3%82%A3%E3%82%B6%E3%83%BC%E3%83%89%E3%81%AB%E5%BE%93%E3%81%A3%E3%81%A6%E3%81%84%E3%81%91%E3%81%B0%E5%B0%8E%E5%85%A5%E3%81%AF%E7%B5%82%E4%BA%86%E3%80%82%E7%B0%A1%E5%8D%98%E3%81%A7%E3%81%82%E3%82%8B%E3%80%82</a></p>

<a name="CRUD"></a>
<h2>CRUD</h2>

<p>Couchbaseã¯REST APIã‚’å‚™ãˆã¦ã„ã‚‹ãŒã€ç”¨é€”ã¨ã—ã¦ã¯ãƒãƒ¼ãƒ‰ã‚„ã‚¯ãƒ©ã‚¹ã‚¿ã®ç®¡ç†ã«åˆ©ç”¨ã™ã‚‹ã®ãŒæ­£ã—ã„ã£ã½ã„ã€‚<br>
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æœ‰ã‚‹ã€‚</p>

<blockquote><p>REST APIã¯ã‚µãƒ¼ãƒã¸ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿æ›¸ãã«åˆ©ç”¨ã™ã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ãŸã¨ãˆã°ã€setã‚„getãªã©ã®ãƒ‡ãƒ¼ã‚¿æ“ä½œã¯Couchbase SDKã«ã‚ˆã£ã¦å‡¦ç†ã—ã¾ã™ã€‚
Couchbase SDKã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚</p></blockquote>

<p>ã¨ã„ã†ã‚ã‘ã§ã€CRUDã‚’è©¦ã™ãŸã‚ã«ã¯SDKãŒå¿…è¦ã§ã‚ã‚‹ã€‚</p>

<a name="Python.SDK"></a>
<h2>Python SDK</h2>

<p>ä»Šå›ã¯ã‚µã‚¯ãƒƒã¨ã‚„ã‚ŠãŸã„ã®ã§Python SDKã‚’ä½¿ã†ã€‚Python SDKã¯Couchbaseã®C SDKã‚’ä½¿ã£ã¦ä½œã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€ã¾ãš C SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚<br>
ã¡ãªã¿ã«å…¬å¼ã®<a href="http://www.couchbase.com/communities/python/getting-started">Getting Start</a>ã«å¾“ã£ãŸã€‚</p>

<pre><code>[sgyk@fujishima]
$ brew install libcouchbase
==&gt; Downloading http://packages.couchbase.com/clients/c/libcouchbase-2.0.7.tar.gz
######################################################################## 100.0%
==&gt; ./configure --prefix=/usr/local/Cellar/libcouchbase/2.0.7 --disable-examples --disable-tests --disable-couchbasemock
==&gt; make install
ğŸº  /usr/local/Cellar/libcouchbase/2.0.7: 106 files, 964K, built in 28 seconds
</code></pre>

<p>Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯2.6ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ãŒå¿…è¦ã€‚
<code>
[sgyk@fujishima]
$ python -V
Python 2.7.3
</code></p>

<p>æ¬¡ã«<code>pip</code>ã§SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŒã€Xcodeã®CLI Toolsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦æ‚²ã—ã„æ°—æŒã¡ã«ãªã‚‹ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã‘ã‚Œã°äºˆã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã“ã¨ã€‚
<code>
unable to execute /usr/bin/clang: No such file or directory
</code></p>

<p>Python SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[sgyk@fujishima]
</span><span class='line'>$ pip install couchbase
</span><span class='line'>Downloading/unpacking couchbase
</span><span class='line'>  Running setup.py egg_info for package couchbase&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h1&gt;çœç•¥&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Successfully installed couchbase
</span><span class='line'>Cleaning up&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p>ã¡ã‚ƒã‚“ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‹ã‚’ç¢ºèªã™ã‚‹ã€‚
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[sgyk@fujishima]
</span><span class='line'>$ python
</span><span class='line'>Python 2.7.3 (default, Nov  9 2012, 22:02:35)
</span><span class='line'>[GCC 4.2.1 Compatible Apple Clang 4.0 ((tags/Apple/clang-421.0.60))] on darwin
</span><span class='line'>Type &ldquo;help&rdquo;, &ldquo;copyright&rdquo;, &ldquo;credits&rdquo; or &ldquo;license&rdquo; for more information.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;blockquote&gt;&lt;blockquote&gt;&lt;blockquote&gt;&lt;p&gt;from couchbase import Couchbase&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;```
</span><span class='line'>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã‘ã‚Œã°OK&lt;/p&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ãªã‚“ã‹æ°—ã®åˆ©ã„ãŸã‚„ã¤ã‚’æ›¸ã“ã†ã‹ã¨æ€ã£ãŸã‘ã©ã€&lt;a href="https://github.com/couchbase/couchbase-python-client#using"&gt;githubã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰&lt;/a&gt;ã‚’ã¨ã‚Šã‚ãˆãšè©¦ã—ã¦ã¿ã‚‹ã®ãŒè‰¯ã•ãã†ã€‚&lt;br&gt;
</span><span class='line'>ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãŸã‚‰ã‚ã‹ã‚‹ã‚ˆã†ã«ã€éå¸¸ã«å°‘ãªã„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ‡ãƒ¼ã‚¿æ“ä½œãŒã§ãã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã¨æ€ã†ã€‚&lt;br&gt;
</span><span class='line'>ã‚ã¨ã¯&lt;a href="http://pythonhosted.org/couchbase/"&gt;APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ&lt;/a&gt;ã‚’ã•ã‚‰ã£ã¨è¦‹ã¦ãŠã‘ã°ã¨ã‚Šã‚ãˆãšã®ã“ã¨ã¯ã§ããã†ã§ã¯ã‚ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="Fluentd............"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;Fluentdã¨ã®é€£æº&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;æ­£ç›´ã€ã‚ã‚“ã¾ã‚Šæ›¸ãã¹ãã“ã¨ã¯ãªã‹ã£ãŸã‚Šã™ã‚‹ã€‚ã¨ã„ã†ã®ã‚‚ã€ã™ã§ã«&lt;a href="https://github.com/obieq/fluent-plugin-couchbase#"&gt;ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹&lt;/a&gt;ãŸã‚ã€ãã‚Œã‚’ä½¿ãˆã°ã‚ã£ã¨ã„ã†é–“ã«ã§ãã‚‹ã€‚å°‘ã—ãƒãƒã£ãŸã¨ã“ã‚ã¯ã€æ›¸ãè¾¼ã¿ã®ç®‡æ‰€ãŒ&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code class="ruby"&gt;# https://github.com/obieq/fluent-plugin-couchbase/blob/master/lib/fluent/plugin/out_couchbase.rb#L52
</span><span class='line'>connection[record.delete('key'),  :ttl =&gt; self.ttl] = record
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã¨ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸­ã«keyã¨ã„ã†è¦ç´ ï¼ˆrubyã§ã„ã†ã¨ã“ã‚ã®ã‚¨ãƒ³ãƒˆãƒªï¼Ÿï¼‰ãŒå¿…è¦ã«ãªã‚‹ã€‚ã“ã‚ŒãŒç„¡ã„ã¨ã€couchbaseã«æ›¸ãè¾¼ã‚€éš›ã«ãƒ­ã‚°ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ&lt;code&gt;nil&lt;/code&gt;ã¨ãªã£ã¦ã—ã¾ã„ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã€‚&lt;br&gt;
</span><span class='line'>ãã‚Œä»¥å¤–ã¯td-agentã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€couchbaseãŒã‚ˆã‚ã—ãã‚„ã£ã¦ãã‚Œã‚‹ãŸã‚éå¸¸ã«æ¥½ã«æ ¼ç´ã§ãã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã¾ãŸã€couchbaseã¯ãƒã‚±ãƒƒãƒˆã”ã¨ã«èªè¨¼ã‚’è¨­ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ãŒã€ä¸Šã§ç´¹ä»‹ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ãƒã‚±ãƒƒãƒˆèªè¨¼ã«å¯¾å¿œã—ã¦ã„ãªã„ã€‚&lt;br&gt;
</span><span class='line'>ã“ã‚Œã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã¯&lt;a href="https://github.com/atware/fluent-plugin-couchbase"&gt;atware/fluent-plugin-couchbase&lt;/a&gt;ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ã€‚ã¡ãªã¿ã«&lt;a href="http://www.atware.co.jp/"&gt;æ ªå¼ä¼šç¤¾ ã‚¢ãƒƒãƒˆã‚¦ã‚§ã‚¢&lt;/a&gt;ã¨ã„ã†ä¼šç¤¾ã¯å¤šåˆ†ã€ä»Šã®ã¨ã“ã‚ã€æ—¥æœ¬ã§ä¸€ç•ªCouchbaseã«ç²¾é€šã—ã¦ã„ã‚‹ä¼šç¤¾ã‹ã‚‚ã—ã‚Œãªã„ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;ä»Šå¾Œ&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Couchbaseã®å°å…¥ã‹ã‚‰td-agentã®é€£æºã¾ã§ã®ä½œæ¥­ã¯æ…£ã‚ŒãŸã‚‰å¤šåˆ†1æ™‚é–“ã‹ã‹ã‚‰ãªã„ã€‚&lt;br&gt;å•é¡Œã¯ã‚€ã—ã‚ã“ã®å¾Œã«ã‚ã£ã¦ã€Couchbaseã§ã¯RDBã§ã„ã†ã¨ã“ã‚ã®SQLã®ã‚ˆã†ãªDMLã¯Viewã¨å‘¼ã°ã‚Œã‚‹Javascriptã®MapReduceã§è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ãªã®ã§ã€ãƒ­ã‚°ã®é‹ç”¨ã‚’Couchbaseã«åˆ‡ã‚Šæ›¿ãˆã‚‹å ´åˆã¯ã€å¦‚ä½•ã«ã—ã¦ã“ã‚Œã¾ã§RDBã§å‹•ã‹ã—ã¦ããŸSQLã‚’ç§»è¡Œã™ã‚‹ã‹ãŒå¤§ããªå•é¡Œã¨ãªã‚‹ã€‚SQLãƒãƒªãƒãƒªã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒJavascriptã‚’åŒã˜ç¨‹åº¦æ›¸ã‘ã‚‹ã‹ã¨è¨€ã‚ã‚Œã‚‹ã¨å¤šãã¯ãã†ã§ãªã„ã¨æ€ã†ã®ã§ã€‚ã¾ãã“ã‚Œã¯NoSQLç³»DBã‚’é‹ç”¨ã™ã‚‹ã¨ãã®å®¿å‘½ãªã®ã§ä»Šæ›´ã„ã†ã“ã¨ã§ã‚‚ç„¡ã„ã‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Couchbaseã®Viewã«ã¤ã„ã¦ã¯ã¾ãŸè‰²ã€…èª¿ã¹ã¦ã€ãƒ–ãƒ­ã‚°ã«ã¾ã¨ã‚ã‚ˆã†ã‹ãªã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="http://www.atware.co.jp/2013/07/25/fluentd-couchbase-log-analysis/"&gt;Fluentd + Couchbase ã«ã‚ˆã‚‹ãƒ­ã‚°è§£æå°å…¥äº‹ä¾‹&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="http://www.atmarkit.co.jp/fdb/rensai/dbwatch2012/dbwatch201202_02.html"&gt;ã©ã£ã¡ãŒé¢ç™½ã„ï¼Ÿ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæŒ‡å‘ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="http://pythonhosted.org/couchbase/"&gt;Couchbase Python Client Library Documentation&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="https://github.com/obieq/fluent-plugin-couchbase"&gt;obieq/fluent-plugin-couchbase&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;li&gt;&lt;a href="http://aws.typepad.com/aws/2013/08/running-couchbase-on-aws-new-white-paper.html"&gt;Running Couchbase on AWS - New White Paper&lt;/a&gt;&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>]]&gt;&lt;/content&gt;
</span><span class='line'>  &lt;/entry&gt;
</span><span class='line'>  
</span><span class='line'>  &lt;entry&gt;
</span><span class='line'>    &lt;title type="html"&gt;&lt;![CDATA[ec2ã«fluentdã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹]]&gt;&lt;/title&gt;
</span><span class='line'>    &lt;link href="http://sgykfjsm.github.io/blog/2013/08/11/fluentd-on-ec2-with-s3/"/&gt;
</span><span class='line'>    &lt;updated&gt;2013-08-11T02:23:00+09:00&lt;/updated&gt;
</span><span class='line'>    &lt;id&gt;http://sgykfjsm.github.io/blog/2013/08/11/fluentd-on-ec2-with-s3&lt;/id&gt;
</span><span class='line'>    &lt;content type="html"&gt;&lt;![CDATA[&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;ç›®çš„&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fluentdã‚’ec2ã«å°å…¥ã—ã¦S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;å°å…¥&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;é€å‡ºå´ã¨åé›†å´ã¯ã©ã¡ã‚‰ã‚‚m1.microã€Amazon Linuxã§ç”¨æ„ã—ãŸã€‚&lt;br&gt;
</span><span class='line'>æ‰‹é †ã¯å…¬å¼ã®&lt;a href="http://docs.fluentd.org/articles/install-by-rpm"&gt;Installing Fluentd Using rpm Package&lt;/a&gt;ã«å¾“ã£ãŸã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;!-- more --&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;a name="L........................................................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚¿ã®æ•°ã‚’å¤‰æ›´ã™ã‚‹ã€‚&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo cp -p /etc/security/limits.conf /etc/security/limits.conf.org
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo vim /etc/security/limits.conf
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ diff /etc/security/limits.conf.org /etc/security/limits.conf
</span><span class='line'>49a50,54
</span><span class='line'>&gt; root soft nofile 65536
</span><span class='line'>&gt; root hard nofile 65536
</span><span class='line'>&gt; * soft nofile 65536
</span><span class='line'>&gt; * hard nofile 65536
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo shutdown -r now
</span><span class='line'># å†èµ·å‹•å®Œäº†å¾Œã«å†åº¦ãƒ­ã‚°ã‚¤ãƒ³
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ ulimit -n
</span><span class='line'>65536
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L....................................................................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚«ãƒ¼ãƒãƒ«ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ã‚’è¿½åŠ ã™ã‚‹ã€‚&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo cp -p /etc/sysctl.conf /etc/sysctl.conf.org
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo vim /etc/sysctl.conf
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ diff /etc/sysctl.conf.org /etc/sysctl.conf
</span><span class='line'>40a41,45
</span><span class='line'>&gt;
</span><span class='line'>&gt; net.ipv4.tcp_tw_recycle = 1
</span><span class='line'>&gt; net.ipv4.tcp_tw_reuse = 1
</span><span class='line'>&gt; net.ipv4.ip_local_port_range = 10240    65535
</span><span class='line'>&gt;
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo sysctl -w
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L.............................................td-agent.............................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ã£ã¦td-agentã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;å¤§é›‘æŠŠã«è¨€ã†ã¨ã€td-agentã¯fluentdã®å®‰å®šç¨¼åƒç‰ˆã®ã‚ˆã†ãªã‚‚ã®ã€‚ç´°ã‹ãªé•ã„ã¯&lt;a href="http://docs.fluentd.org/articles/faq#what-is-the-difference-with-td-agent-and-fluentd"&gt;What is the difference with td-agent and Fluentd?&lt;/a&gt;ã‚’å‚ç…§ã®ã“ã¨ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo curl -L http://toolbelt.treasure-data.com/sh/install-redhat.sh | sh
</span><span class='line'># çœç•¥
</span><span class='line'>Installed:
</span><span class='line'>  td-agent.x86_64 0:1.1.15-0
</span><span class='line'>
</span><span class='line'>Dependency Installed:
</span><span class='line'>  compat-libtermcap.x86_64 0:2.0.8-49.2.amzn1 compat-readline5.x86_64 0:5.2-17.3.amzn1 openssl098e.x86_64 0:0.9.8e-17.8.amzn1
</span><span class='line'>  td-libyaml.x86_64 0:0.1.4-1
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......"&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;èµ·å‹•&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo /etc/init.d/td-agent start
</span><span class='line'>Starting td-agent:                                         [  OK  ]
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;è©¦ã—ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ­ã‚°ã‚’POSTã—ã¦ã¿ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ curl -X POST -d 'json={"json":"message"}' http://localhost:8888/debug.test
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ cat /var/log/td-agent/td-agent.log
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: starting fluentd-0.10.36
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: reading config file path="/etc/td-agent/td-agent.conf"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: using configuration file: &lt;ROOT&gt;
</span><span class='line'>  &lt;match td.*.*&gt;
</span><span class='line'>    type tdlog
</span><span class='line'>    apikey YOUR_API_KEY
</span><span class='line'>    auto_create_table
</span><span class='line'>    buffer_type file
</span><span class='line'>    buffer_path /var/log/td-agent/buffer/td
</span><span class='line'>  &lt;/match&gt;
</span><span class='line'>  &lt;match debug.**&gt;
</span><span class='line'>    type stdout
</span><span class='line'>  &lt;/match&gt;
</span><span class='line'>  &lt;source&gt;
</span><span class='line'>    type forward
</span><span class='line'>  &lt;/source&gt;
</span><span class='line'>  &lt;source&gt;
</span><span class='line'>    type http
</span><span class='line'>    port 8888
</span><span class='line'>  &lt;/source&gt;
</span><span class='line'>  &lt;source&gt;
</span><span class='line'>    type debug_agent
</span><span class='line'>    bind 127.0.0.1
</span><span class='line'>    port 24230
</span><span class='line'>  &lt;/source&gt;
</span><span class='line'>&lt;/ROOT&gt;
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: adding source type="forward"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: adding source type="http"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: adding source type="debug\_agent"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: adding match pattern="td.\*.\*" type="tdlog"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: adding match pattern="debug.\*\*" type="stdout"
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: listening fluent socket on 0.0.0.0:24224
</span><span class='line'>2013-08-10 09:49:33 +0000 [info]: listening dRuby uri="druby://127.0.0.1:24230" object="Engine"
</span><span class='line'>2013-08-10 09:50:44 +0000 debug.test: {"json":"message"}
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="Development.tools..............."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;Development toolsã‚’å…¥ã‚Œã‚‹ã€‚&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fluentdã¯è‡ªåˆ†ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’æŒã£ã¦ãŠã‚Šã€å„ç¨®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ãã‚Œã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚
</span><span class='line'>æœ€åˆã«ãã®ãƒªãƒã‚¸ãƒˆãƒªã‚’updateã™ã‚‹ãŒã€ãã®éš›ã«å¿…è¦ã¨ãªã‚‹è«¸ã€…ã‚’Development toolsã‚’å°å…¥ã™ã‚‹ã“ã¨ã§è§£æ±ºã—ã¦ãŠãã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo yum groupinstall -y "Development tools"
</span><span class='line'>Loaded plugins: priorities, security, update-motd, upgrade-helper
</span><span class='line'>amzn-main                                                                                                       | 2.1 kB     00:00
</span><span class='line'>amzn-updates                                                                                                    | 2.3 kB     00:00
</span><span class='line'>Setting up Group Process
</span><span class='line'># çœç•¥
</span><span class='line'>  systemtap-client.x86\_64 0:1.8-7.14.amzn1                        systemtap-devel.x86\_64 0:1.8-7.14.amzn1
</span><span class='line'>
</span><span class='line'>Complete!
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="fluentd.........................................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h3&gt;fluentdã®ãƒªãƒã‚¸ãƒˆãƒªã‚’æ›´æ–°ã—ã¦ãŠãã€‚&lt;/h3&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯å¿…è¦ã«å¿œã˜ã¦ã—ã¦ãŠã‘ã°è‰¯ã„ã®ã§ã€ã¨ã‚Šã‚ãˆãšãƒªãƒã‚¸ãƒˆãƒªã‚’æ›´æ–°ã—ã¦ãŠãã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# fluentdã‚’å°å…¥ã—ãŸå…¨ã¦ã®ã‚µãƒ¼ãƒã§å®Ÿæ–½ã—ã¦ãŠãã¨è‰¯ã„ã€‚
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem update
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;çµæ§‹æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã“ã“ã¾ã§ã¨åŒã˜ä½œæ¥­ã‚’ã‚‚ã†1å°ã®ã‚µãƒ¼ãƒã§è¡Œã„ã€ã‚µãƒ¼ãƒé–“ã§ãƒ­ã‚°ã®ã‚„ã‚Šå–ã‚ŠãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L......1......td-agent..........................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;ã‚‚ã†1ã¤ã®td-agentã«ãƒ­ã‚°ã‚’é€å‡ºã™ã‚‹ã€‚&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã¨ã‚Šã‚ãˆãštd-agentãŒæ­£å¸¸ã«å°å…¥ã§ãã¦å‹•ä½œã‚‚å•é¡Œç„¡ã•ãã†ã®ã§ã€ã‚‚ã†1ã¤ã®td-agentã«ãƒ­ã‚°ã‚’é€å‡ºã™ã‚‹ã€‚
</span><span class='line'>&lt;a href="http://docs.fluentd.org/articles/high-availability"&gt;Fluentd High Availability Configuration&lt;/a&gt;ã‚’å‚è€ƒã«è¨­å®šã™ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã¾ãšã¯é€å‡ºå´ã®è¨­å®šã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# TCP input
</span><span class='line'>&lt;source&gt;
</span><span class='line'>  type forward
</span><span class='line'>  port 24224
</span><span class='line'>&lt;/source&gt;
</span><span class='line'>
</span><span class='line'># HTTP input
</span><span class='line'>&lt;source&gt;
</span><span class='line'>  type http
</span><span class='line'>  port 8888
</span><span class='line'>&lt;/source&gt;
</span><span class='line'>
</span><span class='line'># Log Forwarding
</span><span class='line'>&lt;match sample.**&gt;
</span><span class='line'>  type forward
</span><span class='line'>
</span><span class='line'>  # primary host
</span><span class='line'>  &lt;server&gt;
</span><span class='line'>    host 10.147.229.126
</span><span class='line'>    port 24224
</span><span class='line'>  &lt;/server&gt;
</span><span class='line'>
</span><span class='line'>  # use longer flush_interval to reduce CPU usage.
</span><span class='line'>  # note that this is a trade-off against latency.
</span><span class='line'>  flush_interval 60s
</span><span class='line'>&lt;/match&gt;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;æ¬¡ã«åé›†å´ã®è¨­å®šã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# Input
</span><span class='line'>&lt;source&gt;
</span><span class='line'>  type forward
</span><span class='line'>  port 24224
</span><span class='line'>  tag sample.app_log
</span><span class='line'>&lt;/source&gt;
</span><span class='line'>
</span><span class='line'># Output
</span><span class='line'>&lt;match sample.app_log&gt;
</span><span class='line'>  type file
</span><span class='line'>  path /var/log/fluent/sample.app_Log.log
</span><span class='line'>  time_slice_format %Y%m%d
</span><span class='line'>  time_slice_wait 1m
</span><span class='line'>  # compress gzip
</span><span class='line'>  utc
</span><span class='line'>&lt;/match&gt;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆãŸã‚‰ã€ãã‚Œãã‚Œã®td-agentã‚’å†èµ·å‹•ã™ã‚‹ã€‚å†èµ·å‹•ã®éš›ã¯&lt;code&gt;/var/log/td-agent/td-agent.log&lt;/code&gt;ã‚’tailã—ãªãŒã‚‰è¡Œã†ã¨ã€ä¸è¦ãªè¨­å®šã‚’ã—ã¦ã„ã‚‹éš›ã«æ°—ã¥ãã“ã¨ãŒã§ãã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;é€å‡ºå´ã§å…ˆã»ã©è©¦ã—ãŸã®ã¨åŒã˜curlã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€ãƒ­ã‚°ãŒåé›†å´ã«æ¥ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
</span><span class='line'>ã¾ãŸã€Security Groupã§äºˆã‚è¨­å®šã—ãŸãƒãƒ¼ãƒˆç•ªå·ã§TCPã¨UDPã®ãƒãƒ¼ãƒˆã‚’ç©ºã‘ã¦ãŠãã“ã¨ã€‚
</span><span class='line'>ã§ãªã„ã¨ã€"no nodes are available"ãŒç™ºç”Ÿã™ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;a name="L........................S3.............................."&gt;&lt;/a&gt;
</span><span class='line'>&lt;h2&gt;å—ã‘å–ã£ãŸãƒ­ã‚°ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;å—ã‘æ‰‹å´ã§ãƒ­ã‚°ã‚’å—ã‘å–ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã‚‰ã€ãã®å—ã‘å–ã£ãŸãƒ­ã‚°ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚
</span><span class='line'>ã¾ãšã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-zz-zzz-zzz-zzz ~]$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-s3
</span><span class='line'>Successfully installed fluent-plugin-s3-0.3.4
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for fluent-plugin-s3-0.3.4...
</span><span class='line'>Installing RDoc documentation for fluent-plugin-s3-0.3.4...
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ã¤ã„ã§ã«ã‚¿ã‚°ã‚’å‹•çš„ã«æ‰±ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã¨ã‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®è¨­å®šã«ç¹°ã‚Šè¿”ã—è¦ç´ ã‚’åŸ‹ã‚è¾¼ã‚ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚å…¥ã‚Œã¦ãŠãã€‚ã“ã‚Œã‚‰ãŒã‚ã‚‹ã¨è‰²ã€…æ—ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-forest
</span><span class='line'>Fetching: fluent-plugin-forest-0.1.4.gem (100%)
</span><span class='line'>Successfully installed fluent-plugin-forest-0.1.4
</span><span class='line'>1 gem installed
</span><span class='line'>Installing ri documentation for fluent-plugin-forest-0.1.4...
</span><span class='line'>Installing RDoc documentation for fluent-plugin-forest-0.1.4...
</span><span class='line'>[ec2-user@ip-xx-xxx-xxx-xxx ~]$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-config-expander
</span><span class='line'>Fetching: fluent-plugin-config-expander-0.1.3.gem (100%)
</span><span class='line'>  Successfully installed fluent-plugin-config-expander-0.1.3
</span><span class='line'>  1 gem installed
</span><span class='line'>  Installing ri documentation for fluent-plugin-config-expander-0.1.3...
</span><span class='line'>  Installing RDoc documentation for fluent-plugin-config-expander-0.1.3...
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;æ¬¡ã«åé›†å´ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã€‚&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# Input
</span><span class='line'>&lt;source&gt;
</span><span class='line'>  type forward
</span><span class='line'>  port 24224
</span><span class='line'>&lt;/source&gt;
</span><span class='line'>
</span><span class='line'># Output
</span><span class='line'>&lt;match sample.*&gt;
</span><span class='line'>  type forest
</span><span class='line'>  subtype s3
</span><span class='line'>  &lt;template&gt; # ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã«ã‚ˆã£ã¦ã€S3ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¨­å®šãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚Œã‚‹ã€‚
</span><span class='line'>    aws_key_id XXX
</span><span class='line'>    aws_sec_key XXX
</span><span class='line'>    s3_bucket dev.sgyk
</span><span class='line'>    # http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region
</span><span class='line'>    s3_endpoint s3-ap-northeast-1.amazonaws.com
</span><span class='line'>    # Fluentd-plugin-forestã«ã‚ˆã£ã¦${tag}ãŒé€å‡ºå´ã§è¨­å®šã—ãŸtagã®å€¤ã«å±•é–‹ã•ã‚Œã‚‹ã€‚
</span><span class='line'>    path ${tag}/
</span><span class='line'>    buffer_path /var/log/td-agent/buffer/${tag}
</span><span class='line'>    # time_slice_format %Y-%m-%d-%H-%M # To write files every minutes
</span><span class='line'>    time_slice_format %Y-%m-%d-%H
</span><span class='line'>    time_slice_wait 60s
</span><span class='line'>    utc
</span><span class='line'>  &lt;/template&gt;
</span><span class='line'>&lt;/match&gt;
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ä¿®æ­£å¾Œã€td-agentã‚’å†èµ·å‹•ã™ã‚‹ã¨ã“ã‚“ãªãƒ­ã‚°ãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚‹</span></code></pre></td></tr></table></div></figure>
2013-08-10 17:11:19 +0000 [info]: out_forest plants new output: s3 for tag &lsquo;sample.app_log&rsquo;
2013-08-10 17:11:21 +0000 [info]: out_forest plants new output: s3 for tag &lsquo;sample.str_log&rsquo;</p>

<a name="L..........................................curl............"></a>
<h1>ã¡ãªã¿ã«é€å‡ºå´ã§ä»¥ä¸‹ã®ã‚ˆã†ã«curlã—ã¦ã„ã‚‹</h1>

<a name="L..bin.bash"></a>
<h1>!/bin/bash</h1>

<p>#</p>

<a name="i.0."></a>
<h1>i=0;</h1>

<a name="str..code.uuidgen...tr.-d..-...code."></a>
<h1>str=<code>uuidgen | tr -d '-'</code></h1>

<a name="while.true."></a>
<h1>while(true)</h1>

<a name="do"></a>
<h1>do</h1>

<a name="curl.-X.POST.-d..json....i..:.i....json..:....RANDOM......http:..localhost:8888.sample.app_log"></a>
<h1>curl -X POST -d &ldquo;json={&#34;i\&rdquo;:$i, \&ldquo;json\&rdquo;:\&ldquo;${RANDOM}\&rdquo;}&ldquo; <a href="http://localhost:8888/sample.app_log">http://localhost:8888/sample.app_log</a></h1>

<a name="curl.-X.POST.-d..json....i..:.i....str..:....str......http:..localhost:8888.sample.str_log"></a>
<h1>curl -X POST -d &ldquo;json={&#34;i\&rdquo;:$i, \&ldquo;str\&rdquo;:\&ldquo;${str}\&rdquo;}&ldquo; <a href="http://localhost:8888/sample.str_log">http://localhost:8888/sample.str_log</a></h1>

<a name="i..code.expr..i...1..code."></a>
<h1>i=<code>expr $i + 1</code></h1>

<a name="sleep.10"></a>
<h1>sleep 10</h1>

<a name="done"></a>
<h1>done</h1>

<p>#</p>

<a name="exit.0"></a>
<h1>exit 0</h1>

<p>&#8220;`</p>

<p>ã‚ã¨ã¯10åˆ†ã»ã©çµŒã£ã¦ã‹ã‚‰æŒ‡å®šã—ãŸãƒã‚±ãƒƒãƒˆã‚’è¦‹ã«è¡Œãã¨gzå½¢å¼ã§å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã®ãŒç¢ºèªã§ãã‚‹ã€‚</p>
]]></content>
  </entry>
  
</feed>
